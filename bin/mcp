#!/usr/bin/env bash
# =============================================================================
# HVAC-ADS-2026 MCP Server Launcher
# Phase D0: Containerization + MCP Connector Stubs
# =============================================================================
#
# Usage:
#   bin/mcp              # Start MCP server (default port 8080)
#   bin/mcp --port 9000  # Start on custom port
#
# =============================================================================

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_ROOT"

# Parse arguments
PORT="${MCP_PORT:-8080}"
HOST="${MCP_HOST:-0.0.0.0}"

while [[ $# -gt 0 ]]; do
    case $1 in
        --port)
            PORT="$2"
            shift 2
            ;;
        --host)
            HOST="$2"
            shift 2
            ;;
        -h|--help)
            echo "Usage: bin/mcp [OPTIONS]"
            echo ""
            echo "Options:"
            echo "  --port PORT   Server port (default: 8080)"
            echo "  --host HOST   Server host (default: 0.0.0.0)"
            echo "  -h, --help    Show this help message"
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done

# Export environment variables
export MCP_PORT="$PORT"
export MCP_HOST="$HOST"
export PYTHONPATH="$PROJECT_ROOT"

# Load .env if exists
if [[ -f "$PROJECT_ROOT/.env" ]]; then
    set -a
    source "$PROJECT_ROOT/.env"
    set +a
fi

# Run MCP server
exec python3 -m core.mcp.server
